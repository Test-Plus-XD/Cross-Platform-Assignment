<!-- Store management page with restaurant editing, menu management, and bookings -->
<br><br>
<ion-content fullscreen>
  <ng-container *ngIf="isMobile$ | async as isMobile">
    <div class="page-container" [class.mobile-layout]="isMobile" [class.web-layout]="!isMobile">

      <!-- Pull to refresh -->
      <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
        <ion-refresher-content></ion-refresher-content>
      </ion-refresher>

      <!-- No restaurant linked state -->
      <div class="empty-state" *ngIf="!isRestaurantLoading && !hasRestaurant">
        <ion-icon name="storefront-outline" class="empty-icon"></ion-icon>
        <h2>{{ (lang$ | async) === 'TC' ? translations.noRestaurant.TC : translations.noRestaurant.EN }}</h2>
        <p>{{ (lang$ | async) === 'TC' ? translations.contactSupport.TC : translations.contactSupport.EN }}</p>
      </div>

      <!-- Main content when restaurant exists -->
      <div *ngIf="hasRestaurant" class="store-container">

        <!-- Restaurant header card -->
        <ion-card class="header-card">
          <ion-card-content>
            <div class="header-content">
              <div class="restaurant-name-section">
                <h2>{{ (lang$ | async) === 'TC' ? (restaurant?.Name_TC || restaurant?.Name_EN) : (restaurant?.Name_EN || restaurant?.Name_TC) }}</h2>
                <p class="district">
                  <ion-icon name="location-outline"></ion-icon>
                  {{ (lang$ | async) === 'TC' ? (restaurant?.District_TC || restaurant?.District_EN) : (restaurant?.District_EN || restaurant?.District_TC) }}
                </p>
              </div>
              <ion-button fill="outline" size="small" (click)="viewPublicPage()">
                <ion-icon name="eye-outline" slot="start"></ion-icon>
                {{ (lang$ | async) === 'TC' ? translations.viewPublicPage.TC : translations.viewPublicPage.EN }}
              </ion-button>
            </div>
          </ion-card-content>
        </ion-card>

        <!-- Statistics cards -->
        <div class="stats-grid">
          <ion-card class="stat-card">
            <ion-card-content>
              <ion-icon name="today-outline" color="primary"></ion-icon>
              <div class="stat-value">{{ getTodayBookingsCount() }}</div>
              <div class="stat-label">{{ (lang$ | async) === 'TC' ? translations.todayBookings.TC : translations.todayBookings.EN }}</div>
            </ion-card-content>
          </ion-card>

          <ion-card class="stat-card">
            <ion-card-content>
              <ion-icon name="hourglass-outline" color="warning"></ion-icon>
              <div class="stat-value">{{ getPendingBookingsCount() }}</div>
              <div class="stat-label">{{ (lang$ | async) === 'TC' ? translations.pendingBookings.TC : translations.pendingBookings.EN }}</div>
            </ion-card-content>
          </ion-card>

          <ion-card class="stat-card">
            <ion-card-content>
              <ion-icon name="calendar-outline" color="success"></ion-icon>
              <div class="stat-value">{{ bookings.length }}</div>
              <div class="stat-label">{{ (lang$ | async) === 'TC' ? translations.totalBookings.TC : translations.totalBookings.EN }}</div>
            </ion-card-content>
          </ion-card>
        </div>

        <!-- Section tabs -->
        <ion-segment [value]="currentSection" (ionChange)="switchSection($any($event).detail.value)" class="section-tabs">
          <ion-segment-button value="info">
            <ion-label>
              <ion-icon name="information-circle-outline"></ion-icon>
              {{ (lang$ | async) === 'TC' ? translations.restaurantInfo.TC : translations.restaurantInfo.EN }}
            </ion-label>
          </ion-segment-button>
          <ion-segment-button value="menu">
            <ion-label>
              <ion-icon name="restaurant-outline"></ion-icon>
              {{ (lang$ | async) === 'TC' ? translations.menuManagement.TC : translations.menuManagement.EN }}
            </ion-label>
          </ion-segment-button>
          <ion-segment-button value="bookings">
            <ion-label>
              <ion-icon name="calendar-outline"></ion-icon>
              {{ (lang$ | async) === 'TC' ? translations.bookingsOverview.TC : translations.bookingsOverview.EN }}
            </ion-label>
          </ion-segment-button>
        </ion-segment>

        <!-- SECTION 1: Restaurant Information -->
        <div *ngIf="currentSection === 'info'" class="section-content">

          <!-- Action buttons -->
          <div class="action-buttons">
            <ion-button *ngIf="!isEditingInfo" expand="block" (click)="startEditingInfo()">
              <ion-icon name="create-outline" slot="start"></ion-icon>
              {{ (lang$ | async) === 'TC' ? translations.editInfo.TC : translations.editInfo.EN }}
            </ion-button>
            <div *ngIf="isEditingInfo" class="edit-actions">
              <ion-button expand="block" color="success" (click)="saveRestaurantInfo()">
                <ion-icon name="save-outline" slot="start"></ion-icon>
                {{ (lang$ | async) === 'TC' ? translations.saveChanges.TC : translations.saveChanges.EN }}
              </ion-button>
              <ion-button expand="block" fill="outline" (click)="cancelEditingInfo()">
                <ion-icon name="close-outline" slot="start"></ion-icon>
                {{ (lang$ | async) === 'TC' ? translations.cancel.TC : translations.cancel.EN }}
              </ion-button>
            </div>
          </div>

          <!-- Basic Information -->
          <ion-card class="info-card">
            <ion-card-header>
              <ion-card-title>
                <ion-icon name="document-text-outline"></ion-icon>
                {{ (lang$ | async) === 'TC' ? '基本資料' : 'Basic Information' }}
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>

              <!-- Name (English) -->
              <div class="info-row">
                <div class="info-label">
                  <ion-icon name="restaurant-outline"></ion-icon>
                  {{ (lang$ | async) === 'TC' ? translations.nameEN.TC : translations.nameEN.EN }}
                </div>
                <div class="info-value" *ngIf="!isEditingInfo">
                  {{ restaurant?.Name_EN || '—' }}
                </div>
                <div *ngIf="isEditingInfo" class="edit-input-wrapper">
                  <ion-input [(ngModel)]="editedInfo.Name_EN"
                             [placeholder]="(lang$ | async) === 'TC' ? '輸入英文名稱' : 'Enter name in English'">
                  </ion-input>
                </div>
              </div>

              <!-- Name (Chinese) -->
              <div class="info-row">
                <div class="info-label">
                  <ion-icon name="restaurant-outline"></ion-icon>
                  {{ (lang$ | async) === 'TC' ? translations.nameTC.TC : translations.nameTC.EN }}
                </div>
                <div class="info-value" *ngIf="!isEditingInfo">
                  {{ restaurant?.Name_TC || '—' }}
                </div>
                <div *ngIf="isEditingInfo" class="edit-input-wrapper">
                  <ion-input [(ngModel)]="editedInfo.Name_TC"
                             [placeholder]="(lang$ | async) === 'TC' ? '輸入中文名稱' : 'Enter name in Chinese'">
                  </ion-input>
                </div>
              </div>

              <!-- Address (English) -->
              <div class="info-row">
                <div class="info-label">
                  <ion-icon name="map-sharp"></ion-icon>
                  {{ (lang$ | async) === 'TC' ? translations.addressEN.TC : translations.addressEN.EN }}
                </div>
                <div class="info-value" *ngIf="!isEditingInfo">
                  {{ restaurant?.Address_EN || '—' }}
                </div>
                <div *ngIf="isEditingInfo" class="edit-input-wrapper">
                  <ion-input [(ngModel)]="editedInfo.Address_EN"
                             [placeholder]="(lang$ | async) === 'TC' ? '輸入英文地址' : 'Enter address in English'">
                  </ion-input>
                </div>
              </div>

              <!-- Address (Chinese) -->
              <div class="info-row">
                <div class="info-label">
                  <ion-icon name="map-sharp"></ion-icon>
                  {{ (lang$ | async) === 'TC' ? translations.addressTC.TC : translations.addressTC.EN }}
                </div>
                <div class="info-value" *ngIf="!isEditingInfo">
                  {{ restaurant?.Address_TC || '—' }}
                </div>
                <div *ngIf="isEditingInfo" class="edit-input-wrapper">
                  <ion-input [(ngModel)]="editedInfo.Address_TC"
                             [placeholder]="(lang$ | async) === 'TC' ? '輸入中文地址' : 'Enter address in Chinese'">
                  </ion-input>
                </div>
              </div>

              <!-- District -->
              <div class="info-row">
                <div class="info-label">
                  <ion-icon name="location-outline"></ion-icon>
                  {{ (lang$ | async) === 'TC' ? translations.district.TC : translations.district.EN }}
                </div>
                <div class="info-value" *ngIf="!isEditingInfo">
                  {{ (lang$ | async) === 'TC' ? (restaurant?.District_TC || restaurant?.District_EN || '—') : (restaurant?.District_EN || restaurant?.District_TC || '—') }}
                </div>
                <div *ngIf="isEditingInfo" class="edit-input-wrapper inline-selector">
                  <ion-button fill="outline" size="small" class="selector-button" (click)="showDistrictSelector()">
                    {{ (lang$ | async) === 'TC' ? (editedInfo.District_TC || translations.selectDistrict.TC) : (editedInfo.District_EN || translations.selectDistrict.EN) }}
                    <ion-icon name="chevron-down-outline" slot="end"></ion-icon>
                  </ion-button>
                </div>
              </div>

              <!-- Seats -->
              <div class="info-row">
                <div class="info-label">
                  <ion-icon name="people-outline"></ion-icon>
                  {{ (lang$ | async) === 'TC' ? translations.seats.TC : translations.seats.EN }}
                </div>
                <div class="info-value" *ngIf="!isEditingInfo">
                  {{ restaurant?.Seats || '—' }}
                </div>
                <div *ngIf="isEditingInfo" class="edit-input-wrapper">
                  <ion-input [(ngModel)]="editedInfo.Seats"
                             type="number"
                             [placeholder]="(lang$ | async) === 'TC' ? '輸入座位數' : 'Enter number of seats'">
                  </ion-input>
                </div>
              </div>

            </ion-card-content>
          </ion-card>

          <!-- Contact Information -->
          <ion-card class="info-card">
            <ion-card-header>
              <ion-card-title>
                <ion-icon name="call-outline"></ion-icon>
                {{ (lang$ | async) === 'TC' ? '聯絡資料' : 'Contact Information' }}
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>

              <!-- Phone -->
              <div class="info-row">
                <div class="info-label">
                  <ion-icon name="call-outline"></ion-icon>
                  {{ (lang$ | async) === 'TC' ? translations.phone.TC : translations.phone.EN }}
                </div>
                <div class="info-value" *ngIf="!isEditingInfo">
                  {{ restaurant?.Contacts?.Phone || '—' }}
                </div>
                <div *ngIf="isEditingInfo" class="edit-input-wrapper">
                  <ion-input [(ngModel)]="editedInfo.Contacts.Phone"
                             type="tel"
                             [placeholder]="(lang$ | async) === 'TC' ? '輸入電話號碼' : 'Enter phone number'">
                  </ion-input>
                </div>
              </div>

              <!-- Email -->
              <div class="info-row">
                <div class="info-label">
                  <ion-icon name="mail-outline"></ion-icon>
                  {{ (lang$ | async) === 'TC' ? translations.email.TC : translations.email.EN }}
                </div>
                <div class="info-value" *ngIf="!isEditingInfo">
                  {{ restaurant?.Contacts?.Email || '—' }}
                </div>
                <div *ngIf="isEditingInfo" class="edit-input-wrapper">
                  <ion-input [(ngModel)]="editedInfo.Contacts.Email"
                             type="email"
                             [placeholder]="(lang$ | async) === 'TC' ? '輸入電郵地址' : 'Enter email address'">
                  </ion-input>
                </div>
              </div>

              <!-- Website -->
              <div class="info-row">
                <div class="info-label">
                  <ion-icon name="globe-outline"></ion-icon>
                  {{ (lang$ | async) === 'TC' ? translations.website.TC : translations.website.EN }}
                </div>
                <div class="info-value" *ngIf="!isEditingInfo">
                  {{ restaurant?.Contacts?.Website || '—' }}
                </div>
                <div *ngIf="isEditingInfo" class="edit-input-wrapper">
                  <ion-input [(ngModel)]="editedInfo.Contacts.Website"
                             type="url"
                             [placeholder]="(lang$ | async) === 'TC' ? '輸入網站網址' : 'Enter website URL'">
                  </ion-input>
                </div>
              </div>

            </ion-card-content>
          </ion-card>

          <!-- Keywords & Categories -->
          <ion-card class="info-card">
            <ion-card-header>
              <ion-card-title>
                <ion-icon name="pricetags-outline"></ion-icon>
                {{ (lang$ | async) === 'TC' ? '分類與標籤' : 'Categories & Tags' }}
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>

              <!-- Keywords -->
              <div class="info-row">
                <div class="info-label">
                  <ion-icon name="pricetag-outline"></ion-icon>
                  {{ (lang$ | async) === 'TC' ? translations.keywords.TC : translations.keywords.EN }}
                </div>
                <div class="info-value keywords-display" *ngIf="!isEditingInfo">
                  <span *ngFor="let keyword of (lang$ | async) === 'TC' ? restaurant?.Keyword_TC : restaurant?.Keyword_EN" class="keyword-chip">
                    {{ keyword }}
                  </span>
                  <span *ngIf="!(restaurant?.Keyword_EN?.length)">—</span>
                </div>
                <div *ngIf="isEditingInfo" class="edit-input-wrapper">
                  <ion-button fill="outline" size="small" (click)="showKeywordsSelector()">
                    <ion-icon name="add-outline" slot="start"></ion-icon>
                    {{ getKeywordDisplay(currentLanguage) }}
                  </ion-button>
                </div>
              </div>

            </ion-card-content>
          </ion-card>

          <!-- Payment Methods -->
          <ion-card class="info-card">
            <ion-card-header>
              <ion-card-title>
                <ion-icon name="card-outline"></ion-icon>
                {{ (lang$ | async) === 'TC' ? translations.payments.TC : translations.payments.EN }}
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>

              <div class="info-row">
                <div class="info-label">
                  <ion-icon name="wallet-outline"></ion-icon>
                  {{ (lang$ | async) === 'TC' ? '接受的付款方式' : 'Accepted Payment Methods' }}
                </div>
                <div class="info-value" *ngIf="!isEditingInfo">
                  <span *ngFor="let payment of restaurant?.Payments" class="payment-chip">
                    {{ payment }}
                  </span>
                  <span *ngIf="!(restaurant?.Payments?.length)">—</span>
                </div>
                <div *ngIf="isEditingInfo" class="edit-input-wrapper">
                  <ion-button fill="outline" size="small" (click)="showPaymentMethodsSelector()">
                    <ion-icon name="add-outline" slot="start"></ion-icon>
                    {{ getPaymentDisplay(currentLanguage) }}
                  </ion-button>
                </div>
              </div>

            </ion-card-content>
          </ion-card>

          <!-- Opening Hour -->
          <ion-card class="info-card">
            <ion-card-header>
              <ion-card-title>
                <ion-icon name="time-outline"></ion-icon>
                {{ (lang$ | async) === 'TC' ? translations.openingHours.TC : translations.openingHours.EN }}
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>

              <!-- Opening Hours -->
              <div *ngFor="let day of weekdays" class="info-row opening-hours-row">
                <div class="info-label">
                  {{ (lang$ | async) === 'TC' ? day.tc : day.en }}
                </div>
                <div class="info-value" *ngIf="!isEditingInfo">
                  {{ restaurant?.Opening_Hours?.[day.en] || ((lang$ | async) === 'TC' ? '未設定' : 'Not set') }}
                </div>
                <div *ngIf="isEditingInfo" class="edit-input-wrapper">
                  <ion-input [(ngModel)]="editedInfo.Opening_Hours[day.en]"
                             [placeholder]="(lang$ | async) === 'TC' ? '例如：09:00-22:00 或 休息' : 'e.g. 09:00-22:00 or Closed' ">
                  </ion-input>
                </div>
              </div>

            </ion-card-content>
          </ion-card>

          <!-- Location Map -->
          <ion-card class="info-card" *ngIf="isEditingInfo">
            <ion-card-header>
              <ion-card-title>
                <ion-icon name="map-outline"></ion-icon>
                {{ (lang$ | async) === 'TC' ? translations.location.TC : translations.location.EN }}
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <p class="map-hint">{{ (lang$ | async) === 'TC' ? translations.clickMapToSet.TC : translations.clickMapToSet.EN }}</p>

              <!-- Leaflet Map Container -->
              <div id="store-map" class="map-container">
                <!-- Map will be initialized by Leaflet -->
              </div>

              <!-- Coordinates display -->
              <div class="coordinates-display" *ngIf="mapMarker">
                <p>
                  <ion-icon name="map-sharp"></ion-icon>
                  {{ (lang$ | async) === 'TC' ? '緯度' : 'Latitude' }}: {{ mapMarker.lat.toFixed(6) }}<br>
                  <ion-icon name="map-sharp"></ion-icon>
                  {{ (lang$ | async) === 'TC' ? '經度' : 'Longitude' }}: {{ mapMarker.lng.toFixed(6) }}
                </p>
              </div>
            </ion-card-content>
          </ion-card>

          <!-- Restaurant Hero Image Upload -->
          <ion-card class="info-card">
            <ion-card-header>
              <ion-card-title>
                <ion-icon name="image-outline"></ion-icon>
                {{ (lang$ | async) === 'TC' ? '餐廳圖片' : 'Restaurant Image' }}
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>

              <!-- Current restaurant image -->
              <div class="current-image-preview" *ngIf="restaurant?.ImageUrl && !restaurantImagePreview">
                <img [src]="restaurant?.ImageUrl || ''" alt="Restaurant Image">
                <p class="image-label">{{ (lang$ | async) === 'TC' ? '當前圖片' : 'Current Image' }}</p>
              </div>

              <!-- Image preview -->
              <div class="image-preview-container" *ngIf="restaurantImagePreview">
                <img [src]="restaurantImagePreview" alt="Preview">
                <ion-button fill="clear" size="small" color="danger" (click)="clearRestaurantImageSelection()">
                  <ion-icon name="close-circle-outline" slot="icon-only"></ion-icon>
                </ion-button>
              </div>

              <!-- Upload controls -->
              <div class="upload-controls" *ngIf="isEditingInfo">
                <input type="file"
                       id="restaurant-image-input"
                       accept="image/*"
                       (change)="onRestaurantImageSelected($event)"
                       style="display: none;">

                <ion-button expand="block" fill="outline" (click)="clickRestaurantImageUploadButton()">
                  <ion-icon name="cloud-upload-outline" slot="start"></ion-icon>
                  {{ (lang$ | async) === 'TC' ? '選擇圖片' : 'Select Image' }}
                </ion-button>

                <ion-button expand="block"
                            [disabled]="!selectedRestaurantImage || isUploadingImage"
                            (click)="uploadRestaurantImage()">
                  <ion-icon name="checkmark-outline" slot="start"></ion-icon>
                  {{ (lang$ | async) === 'TC' ? '上傳圖片' : 'Upload Image' }}
                </ion-button>
              </div>

              <p class="image-hint">
                {{ (lang$ | async) === 'TC' ? '支援 JPEG、PNG、GIF、WebP 格式，最大 10MB' : 'Supports JPEG, PNG, GIF, WebP formats, max 10MB' }}
              </p>

            </ion-card-content>
          </ion-card>

        </div>

        <!-- SECTION 2: Menu Management -->
        <div *ngIf="currentSection  === 'menu' " class="section-content">

          <!-- Action buttons -->
          <div class="menu-action-buttons" *ngIf="!isEditingMenu && !showExtractedItemsReview">
            <ion-button expand="block" (click)="startAddingMenuItem()">
              <ion-icon name="add-outline" slot="start"></ion-icon>
              {{ (lang$ | async) === 'TC' ? translations.addMenuItem.TC : translations.addMenuItem.EN }}
            </ion-button>

            <ion-button expand="block" fill="outline" (click)="clickMenuDocumentUploadButton()" [disabled]="isImportingMenu">
              <ion-icon name="cloud-upload-outline" slot="start"></ion-icon>
              {{ (lang$ | async) === 'TC' ? '批量匯入菜單' : 'Bulk Import Menu' }}
            </ion-button>

            <!-- Hidden file input for menu document upload -->
            <input type="file"
                   id="menu-document-input"
                   accept=".pdf,image/*,.txt,.json"
                   (change)="onMenuDocumentSelected($event)"
                   style="display: none;">
          </div>

          <!-- DocuPipe import status -->
          <ion-card *ngIf="selectedMenuDocument && !showExtractedItemsReview" class="import-status-card">
            <ion-card-content>
              <p><strong>{{ (lang$ | async) === 'TC' ? '已選擇文件' : 'Selected File' }}:</strong> {{ selectedMenuDocument.name }}</p>
              <ion-button expand="block"
                          [disabled]="isImportingMenu"
                          (click)="uploadMenuDocument()">
                <ion-icon name="send-outline" slot="start"></ion-icon>
                {{ (lang$ | async) === 'TC' ? '開始處理' : 'Start Processing' }}
              </ion-button>
              <p *ngIf="isPollingDocuPipe" class="processing-text">
                <ion-spinner name="dots"></ion-spinner>
                {{ (lang$ | async) === 'TC' ? '正在提取菜單項目...' : 'Extracting menu items...' }}
              </p>
            </ion-card-content>
          </ion-card>

          <!-- Extracted items review -->
          <ion-card *ngIf="showExtractedItemsReview" class="extracted-items-card">
            <ion-card-header>
              <ion-card-title>
                <ion-icon name="document-text-outline"></ion-icon>
                {{ (lang$ | async) === 'TC' ? '提取的菜單項目' : 'Extracted Menu Items' }}
              </ion-card-title>
              <p class="review-subtitle">{{ (lang$ | async) === 'TC' ? '請檢查並編輯項目，然後儲存' : 'Please review and edit items before saving' }}</p>
            </ion-card-header>
            <ion-card-content>

              <!-- Extracted items table -->
              <div class="extracted-items-table">
                <div *ngFor="let item of extractedMenuItems; let i=index" class="extracted-item-row">
                  <div class="item-number">{{ i + 1 }}</div>
                  <div class="item-fields">
                    <ion-input [(ngModel)]="item.Name_EN"
                               [placeholder]="(lang$ | async) === 'TC' ? '英文名稱' : 'English Name' ">
                    </ion-input>
                    <ion-input [(ngModel)]="item.Name_TC"
                               [placeholder]="(lang$ | async) === 'TC' ? '中文名稱' : 'Chinese Name' ">
                    </ion-input>
                    <ion-input [(ngModel)]="item.price"
                               type="number"
                               [placeholder]="(lang$ | async) === 'TC' ? '價格' : 'Price' ">
                    </ion-input>
                  </div>
                  <ion-button fill="clear" size="small" color="danger" (click)="removeExtractedItem(i)">
                    <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
                  </ion-button>
                </div>

                <p *ngIf="extractedMenuItems.length  === 0" class="no-items-text">
                  {{ (lang$ | async) === 'TC' ? '未提取到項目' : 'No items extracted' }}
                </p>
              </div>

              <!-- Action buttons -->
              <div class="extracted-items-actions">
                <ion-button expand="block" color="success" (click)="saveExtractedMenuItems()" [disabled]="extractedMenuItems.length===0">
                  <ion-icon name="save-outline" slot="start"></ion-icon>
                  {{ (lang$ | async) === 'TC' ? `儲存全部 (${extractedMenuItems.length})` : `Save All (${extractedMenuItems.length})` }}
                </ion-button>
                <ion-button expand="block" fill="outline" (click)="cancelMenuImport()">
                  <ion-icon name="close-outline" slot="start"></ion-icon>
                  {{ (lang$ | async) === 'TC' ? translations.cancel.TC : translations.cancel.EN }}
                </ion-button>
              </div>

            </ion-card-content>
          </ion-card>

          <!-- Menu item editor -->
          <ion-card class="info-card" *ngIf="isEditingMenu">
            <ion-card-header>
              <ion-card-title>
                <ion-icon name="restaurant-outline"></ion-icon>
                {{ editingMenuItemId ? ((lang$ | async) === 'TC' ? translations.editMenuItem.TC : translations.editMenuItem.EN) : ((lang$ | async) === 'TC' ? translations.addMenuItem.TC : translations.addMenuItem.EN) }}
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>

              <ng-container *ngIf="lang$ | async as lang">
              <!-- Name_EN -->
              <div class="info-row menu-field-row">
                <div class="info-label">
                  <div class="field-label">{{ lang === 'TC' ? translations.nameEN.TC : translations.nameEN.EN }}</div>
                  <div class="field-code">{{ getMenuItemFieldLabel('Name_EN', lang) }}</div>
                </div>
                <div class="edit-input-wrapper">
                  <ion-input [(ngModel)]="editedMenuItem.Name_EN"
                             [placeholder]="lang === 'TC' ? '輸入英文名稱' : 'Enter name in English'">
                  </ion-input>
                </div>
              </div>

              <!-- Name_TC -->
              <div class="info-row menu-field-row">
                <div class="info-label">
                  <div class="field-label">{{ lang === 'TC' ? translations.nameTC.TC : translations.nameTC.EN }}</div>
                  <div class="field-code">{{ getMenuItemFieldLabel('Name_TC', lang) }}</div>
                </div>
                <div class="edit-input-wrapper">
                  <ion-input [(ngModel)]="editedMenuItem.Name_TC"
                             [placeholder]="lang === 'TC' ? '輸入中文名稱' : 'Enter name in Chinese'">
                  </ion-input>
                </div>
              </div>

              <!-- Description_EN -->
              <div class="info-row menu-field-row">
                <div class="info-label">
                  <div class="field-label">{{ lang === 'TC' ? '描述（英文）' : 'Description (English)' }}</div>
                  <div class="field-code">{{ getMenuItemFieldLabel('Description_EN', lang) }}</div>
                </div>
                <div class="edit-input-wrapper">
                  <ion-textarea [(ngModel)]="editedMenuItem.Description_EN"
                                rows="3"
                                [placeholder]="lang === 'TC' ? '輸入英文描述' : 'Enter description in English'">
                  </ion-textarea>
                </div>
              </div>

              <!-- Description_TC -->
              <div class="info-row menu-field-row">
                <div class="info-label">
                  <div class="field-label">{{ lang === 'TC' ? '描述（中文）' : 'Description (Chinese)' }}</div>
                  <div class="field-code">{{ getMenuItemFieldLabel('Description_TC', lang) }}</div>
                </div>
                <div class="edit-input-wrapper">
                  <ion-textarea [(ngModel)]="editedMenuItem.Description_TC"
                                rows="3"
                                [placeholder]="lang === 'TC' ? '輸入中文描述' : 'Enter description in Chinese'">
                  </ion-textarea>
                </div>
              </div>

              <!-- Price -->
              <div class="info-row menu-field-row">
                <div class="info-label">
                  <div class="field-label">{{ lang === 'TC' ? translations.price.TC : translations.price.EN }}</div>
                  <div class="field-code">{{ getMenuItemFieldLabel('price', lang) }}</div>
                </div>
                <div class="edit-input-wrapper">
                  <ion-input [(ngModel)]="editedMenuItem.price"
                             type="number"
                             [placeholder]="lang === 'TC' ? '輸入價格' : 'Enter price'">
                  </ion-input>
                </div>
              </div>

              <!-- Menu Item Image Upload -->
              <div class="info-row menu-field-row">
                <div class="info-label">
                  <div class="field-label">
                    <ion-icon name="image-outline"></ion-icon>
                    {{ lang === 'TC' ? '菜品圖片' : 'Item Image' }}
                  </div>
                  <div class="field-code">{{ getMenuItemFieldLabel('imageUrl', lang) }}</div>
                </div>
                <div class="edit-input-wrapper">

                  <!-- Image preview -->
                  <div class="menu-item-image-preview" *ngIf="menuItemImagePreview">
                    <img [src]="menuItemImagePreview" alt="Preview">
                    <ion-button fill="clear" size="small" color="danger" (click)="clearMenuItemImageSelection()">
                      <ion-icon name="close-circle-outline" slot="icon-only"></ion-icon>
                    </ion-button>
                  </div>

                  <!-- File input -->
                  <input type="file"
                         id="menu-item-image-input"
                         accept="image/*"
                         (change)="onMenuItemImageSelected($event)"
                         style="display: none;">

                  <ion-button size="small" fill="outline" (click)="clickMenuItemImageUploadButton()">
                    <ion-icon name="cloud-upload-outline" slot="start"></ion-icon>
                    {{ (lang$ | async) === 'TC' ? '選擇圖片' : 'Select Image' }}
                  </ion-button>

                  <p class="image-hint" style="margin-top: 8px; font-size: 12px; color: var(--ion-color-medium);">
                    {{ (lang$ | async) === 'TC' ? '最大 10MB' : 'Max 10MB' }}
                  </p>
                </div>
              </div>
              </ng-container>

              <div class="edit-actions">
                <ion-button expand="block" color="success" (click)="saveMenuItem()">
                  <ion-icon name="save-outline" slot="start"></ion-icon>
                  {{ (lang$ | async) === 'TC' ? translations.saveChanges.TC : translations.saveChanges.EN }}
                </ion-button>
                <ion-button expand="block" fill="outline" (click)="cancelEditingMenu(); clearMenuItemImageSelection()">
                  <ion-icon name="close-outline" slot="start"></ion-icon>
                  {{ (lang$ | async) === 'TC' ? translations.cancel.TC : translations.cancel.EN }}
                </ion-button>
              </div>

            </ion-card-content>
          </ion-card>

          <!-- Loading state -->
          <div class="loading-state" *ngIf="isMenuLoading">
            <img src="assets/icon/Eclipse.gif" alt="Loading" class="loading-spinner">
          </div>

          <!-- Menu items list -->
          <div class="menu-list" *ngIf="!isMenuLoading && !isEditingMenu">

            <!-- Empty state -->
            <div class="empty-state" *ngIf="menuItems.length === 0">
              <ion-icon name="restaurant-outline"></ion-icon>
              <p>{{ (lang$ | async) === 'TC' ? translations.noMenuItems.TC : translations.noMenuItems.EN }}</p>
            </div>

            <!-- Menu items -->
            <ion-card *ngFor="let item of menuItems" class="menu-item-card">
              <ion-card-content>
                <div class="menu-item-header">
                  <h3>{{ (lang$ | async) === 'TC' ? (item.Name_TC || item.Name_EN) : (item.Name_EN || item.Name_TC) }}</h3>
                  <div class="menu-item-actions">
                    <ion-button fill="clear" size="small" (click)="startEditingMenuItem(item)">
                      <ion-icon name="create-outline" slot="icon-only"></ion-icon>
                    </ion-button>
                    <ion-button fill="clear" size="small" color="danger" (click)="deleteMenuItem(item)">
                      <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
                    </ion-button>
                  </div>
                </div>

                <!-- Display all non-null values with bilingual support -->
                <div class="menu-item-details">
                  <!-- Current language name (larger, on top) -->
                  <div class="menu-item-field current-language-name">
                    <span class="field-value-primary">
                      {{ (lang$ | async) === 'TC' ? (item.Name_TC || item.Name_EN) : (item.Name_EN || item.Name_TC) }}
                    </span>
                  </div>

                  <!-- Other language name if available -->
                  <div class="menu-item-field other-language-name" *ngIf="(lang$ | async) === 'TC' ? (item.Name_EN && item.Name_EN !== item.Name_TC) : (item.Name_TC && item.Name_TC !== item.Name_EN)">
                    <span class="field-label">{{ (lang$ | async) === 'TC' ? 'English' : '中文' }}:</span>
                    <span class="field-value-secondary">
                      {{ (lang$ | async) === 'TC' ? item.Name_EN : item.Name_TC }}
                    </span>
                  </div>

                  <!-- Current language description (larger) -->
                  <div class="menu-item-field current-language-description" *ngIf="(lang$ | async) === 'TC' ? item.Description_TC : item.Description_EN">
                    <p class="field-value-primary">
                      {{ (lang$ | async) === 'TC' ? item.Description_TC : item.Description_EN }}
                    </p>
                  </div>

                  <!-- Other language description if available -->
                  <div class="menu-item-field other-language-description" *ngIf="(lang$ | async) === 'TC' ? (item.Description_EN && item.Description_EN !== item.Description_TC) : (item.Description_TC && item.Description_TC !== item.Description_EN)">
                    <span class="field-label">{{ (lang$ | async) === 'TC' ? 'English' : '中文' }}:</span>
                    <p class="field-value-secondary">
                      {{ (lang$ | async) === 'TC' ? item.Description_EN : item.Description_TC }}
                    </p>
                  </div>

                  <!-- Price -->
                  <div class="menu-item-field price" *ngIf="item.price !== null && item.price !== undefined">
                    <span class="field-label">{{ (lang$ | async) === 'TC' ? '價格' : 'Price' }}:</span>
                    <span class="field-value-secondary price-value">${{ item.price }}</span>
                  </div>

                  <!-- Image -->
                  <div class="menu-item-field image" *ngIf="getMenuItemImageUrl(item)">
                    <img [src]="getMenuItemImageUrl(item)" alt="Menu item image" class="menu-item-image">
                  </div>
                </div>
              </ion-card-content>
            </ion-card>

          </div>

        </div>

        <!-- SECTION 3: Bookings Overview -->
        <div *ngIf="currentSection === 'bookings'" class="section-content">

          <!-- Loading state -->
          <div class="loading-state" *ngIf="isBookingsLoading">
            <img src="assets/icon/Eclipse.gif" alt="Loading" class="loading-spinner">
          </div>

          <!-- Empty state -->
          <div class="empty-state" *ngIf="!isBookingsLoading && bookings.length === 0">
            <ion-icon name="calendar-outline"></ion-icon>
            <p>{{ (lang$ | async) === 'TC' ? translations.noBookings.TC : translations.noBookings.EN }}</p>
          </div>

          <!-- Bookings list with management actions -->
          <ion-list lines="none" *ngIf="!isBookingsLoading && bookings.length > 0">
            <ion-card *ngFor="let booking of bookings" class="booking-card">
              <ion-card-content>
                <div class="booking-header">
                  <div class="booking-date">
                    {{ booking.dateTime | date: 'short' }}
                  </div>
                  <ion-badge [color]="booking.status === 'pending' ? 'warning' : booking.status === 'confirmed' ? 'success' : booking.status === 'completed' ? 'primary' : 'danger'">
                    {{ booking.status | titlecase }}
                  </ion-badge>
                </div>
                <p class="booking-guests">
                  <ion-icon name="people-outline"></ion-icon>
                  {{ booking.numberOfGuests }} {{ booking.numberOfGuests === 1 ? ((lang$ | async) === 'TC' ? '位' : 'guest') : ((lang$ | async) === 'TC' ? '位' : 'guests') }}
                </p>
                <p class="booking-requests" *ngIf="booking.specialRequests">
                  <ion-icon name="chatbubble-outline"></ion-icon>
                  {{ booking.specialRequests }}
                </p>

                <!-- Action buttons for pending bookings -->
                <div class="booking-actions" *ngIf="booking.status === 'pending'">
                  <ion-button size="small" color="success" (click)="confirmBookingAction(booking)">
                    <ion-icon name="checkmark-outline" slot="start"></ion-icon>
                    {{ (lang$ | async) === 'TC' ? translations.confirmBooking.TC : translations.confirmBooking.EN }}
                  </ion-button>
                  <ion-button size="small" color="danger" fill="outline" (click)="rejectBookingAction(booking)">
                    <ion-icon name="close-outline" slot="start"></ion-icon>
                    {{ (lang$ | async) === 'TC' ? translations.rejectBooking.TC : translations.rejectBooking.EN }}
                  </ion-button>
                </div>

                <!-- Action button for confirmed bookings -->
                <div class="booking-actions" *ngIf="booking.status === 'confirmed'">
                  <ion-button size="small" color="primary" expand="block" (click)="markCompleteAction(booking)">
                    <ion-icon name="checkmark-done-outline" slot="start"></ion-icon>
                    {{ (lang$ | async) === 'TC' ? translations.markComplete.TC : translations.markComplete.EN }}
                  </ion-button>
                </div>
              </ion-card-content>
            </ion-card>
          </ion-list>
        </div>
        <!-- Bottom spacer -->
        <div class="bottom-spacer"></div>
      </div>
    </div>
  </ng-container>
</ion-content>