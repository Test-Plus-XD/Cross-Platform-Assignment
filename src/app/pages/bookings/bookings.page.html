<ion-content class="bookings-page-content">
  <ng-container *ngIf="isMobile$ | async as isMobile">
    <div class="page-container" [class.mobile-layout]="isMobile" [class.web-layout]="!isMobile">

      <!-- Loading State -->
      <div class="loading-container" *ngIf="isLoading">
        <img src="assets/icon/Eclipse.gif" alt="Loading" class="loading-spinner">
        <p>{{ (lang$ | async) === 'TC' ? '載入中...' : 'Loading...' }}</p>
      </div>

      <!-- Bookings Content -->
      <div class="bookings-content" *ngIf="!isLoading">

        <!-- Filter Tabs -->
        <div class="filter-tabs">
          <ion-segment [(ngModel)]="currentFilter" (ionChange)="applyFilter()" mode="md">
            <ion-segment-button value="upcoming">
              <ion-label>
                {{ (lang$ | async) === 'TC' ? translations.upcoming.TC : translations.upcoming.EN }}
                <ion-badge color="primary">{{ getFilterCount('upcoming') }}</ion-badge>
              </ion-label>
            </ion-segment-button>
            <ion-segment-button value="past">
              <ion-label>
                {{ (lang$ | async) === 'TC' ? translations.past.TC : translations.past.EN }}
                <ion-badge color="medium">{{ getFilterCount('past') }}</ion-badge>
              </ion-label>
            </ion-segment-button>
            <ion-segment-button value="cancelled">
              <ion-label>
                {{ (lang$ | async) === 'TC' ? translations.cancelled.TC : translations.cancelled.EN }}
                <ion-badge color="danger">{{ getFilterCount('cancelled') }}</ion-badge>
              </ion-label>
            </ion-segment-button>
          </ion-segment>
        </div>

        <!-- Bookings List -->
        <div class="bookings-list" *ngIf="filteredBookings.length > 0">
          <ion-card class="booking-card" *ngFor="let booking of filteredBookings" (click)="viewRestaurant(booking.restaurantId)">
            <ion-card-content>
              <div class="booking-header">
                <div class="booking-info">
                  <h2 class="restaurant-name">{{ booking.restaurantName }}</h2>
                  <ion-badge [color]="getStatusColor(booking.status)" class="status-badge">
                    {{ (lang$ | async) === 'TC' ? translations[booking.status].TC : translations[booking.status].EN }}
                  </ion-badge>
                </div>
                <div class="booking-actions" *ngIf="canCancel(booking)">
                  <ion-button fill="clear" size="small" color="danger" (click)="cancelBooking(booking); $event.stopPropagation()">
                    <ion-icon name="close-circle-outline" slot="icon-only"></ion-icon>
                  </ion-button>
                </div>
              </div>

              <div class="booking-details">
                <div class="detail-item">
                  <ion-icon name="calendar-outline"></ion-icon>
                  <span>{{ formatDate(booking.dateTime, (lang$ | async) === 'TC') }}</span>
                </div>
                <div class="detail-item">
                  <ion-icon name="time-outline"></ion-icon>
                  <span>{{ formatTime(booking.dateTime, (lang$ | async) === 'TC') }}</span>
                </div>
                <div class="detail-item">
                  <ion-icon name="people-outline"></ion-icon>
                  <span>{{ booking.numberOfGuests }} {{ booking.numberOfGuests === 1 ? ((lang$ | async) === 'TC' ? translations.guest.TC : translations.guest.EN) : ((lang$ | async) === 'TC' ? translations.guests.TC : translations.guests.EN) }}</span>
                </div>
              </div>

              <div class="special-requests" *ngIf="booking.specialRequests">
                <ion-icon name="document-text-outline"></ion-icon>
                <span class="request-label">{{ (lang$ | async) === 'TC' ? translations.specialRequests.TC : translations.specialRequests.EN }}:</span>
                <p>{{ booking.specialRequests }}</p>
              </div>
            </ion-card-content>
          </ion-card>
        </div>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="filteredBookings.length === 0">
          <ion-icon name="calendar-clear-outline" class="empty-icon"></ion-icon>
          <h3>
            <ng-container *ngIf="currentFilter === 'upcoming'">
              {{ (lang$ | async) === 'TC' ? translations.noUpcoming.TC : translations.noUpcoming.EN }}
            </ng-container>
            <ng-container *ngIf="currentFilter === 'past'">
              {{ (lang$ | async) === 'TC' ? translations.noPast.TC : translations.noPast.EN }}
            </ng-container>
            <ng-container *ngIf="currentFilter === 'cancelled'">
              {{ (lang$ | async) === 'TC' ? translations.noCancelled.TC : translations.noCancelled.EN }}
            </ng-container>
            <ng-container *ngIf="currentFilter === 'all'">
              {{ (lang$ | async) === 'TC' ? translations.noBookings.TC : translations.noBookings.EN }}
            </ng-container>
          </h3>
        </div>

        <!-- Bottom Spacer -->
        <div class="bottom-spacer"></div>
      </div>

      <!-- Pull to Refresh -->
      <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
        <ion-refresher-content></ion-refresher-content>
      </ion-refresher>

    </div>
  </ng-container>
</ion-content>
