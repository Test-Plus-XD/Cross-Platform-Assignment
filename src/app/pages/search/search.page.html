<!-- Search page UI: bilingual search, district select, veggie/vegan quick filters -->
<ion-content class="search-page-content">
  <div class="page-container">

    <!-- Search Header Section -->
    <div class="search-header">
      <div class="search-title-container">
        <h1 class="page-title">
          {{ (lang$ | async) === 'TC' ? translations.searchTitle.TC : translations.searchTitle.EN }}
        </h1>
        <p class="page-subtitle">
          {{ (lang$ | async) === 'TC' ? translations.searchSubtitle.TC : translations.searchSubtitle.EN }}
        </p>
      </div>

      <!-- Search Bar -->
      <div class="search-bar-container">
        <ion-searchbar [(ngModel)]="searchQuery"
                       (ionInput)="onSearchInput()"
                       [placeholder]="(lang$ | async) === 'TC' ? translations.searchPlaceholder.TC : translations.searchPlaceholder.EN"
                       [debounce]="300"
                       animated
                       class="modern-searchbar">
        </ion-searchbar>
      </div>

      <!-- Filter Chips -->
      <div class="filter-section">
        <div class="filter-chips-container">
          <!-- District Filter -->
          <ion-chip [outline]="!selectedDistrict"
                    [color]="selectedDistrict ? 'primary' : 'medium'"
                    (click)="openDistrictFilter()"
                    class="filter-chip">
            <ion-icon name="location-outline"></ion-icon>
            <ion-label>
              {{ selectedDistrict || ((lang$ | async) === 'TC' ? translations.allDistricts.TC : translations.allDistricts.EN) }}
            </ion-label>
            <ion-icon name="close-circle" *ngIf="selectedDistrict" (click)="clearDistrict($event)"></ion-icon>
          </ion-chip>

          <!-- Keyword Filter -->
          <ion-chip [outline]="!selectedKeyword"
                    [color]="selectedKeyword ? 'primary' : 'medium'"
                    (click)="openKeywordFilter()"
                    class="filter-chip">
            <ion-icon name="pricetag-outline"></ion-icon>
            <ion-label>
              {{ selectedKeyword || ((lang$ | async) === 'TC' ? translations.allCategories.TC : translations.allCategories.EN) }}
            </ion-label>
            <ion-icon name="close-circle" *ngIf="selectedKeyword" (click)="clearKeyword($event)"></ion-icon>
          </ion-chip>

          <!-- Clear All Filters Button -->
          <ion-chip *ngIf="selectedDistrict || selectedKeyword"
                    color="danger"
                    (click)="clearAllFilters()"
                    class="filter-chip clear-chip">
            <ion-icon name="close-outline"></ion-icon>
            <ion-label>{{ (lang$ | async) === 'TC' ? translations.clearFilters.TC : translations.clearFilters.EN }}</ion-label>
          </ion-chip>
        </div>
      </div>
    </div>

    <!-- Results Summary -->
    <div class="results-summary" *ngIf="!isLoading">
      <p class="results-count">
        <span class="count-number">{{ totalResults }}</span>
        {{ (lang$ | async) === 'TC' ? translations.restaurantsFound.TC : translations.restaurantsFound.EN }}
      </p>
    </div>

    <!-- Loading State -->
    <div class="loading-container" *ngIf="isLoading">
      <img src="assets/icon/Eclipse.gif" alt="Loading" class="loading-spinner">
      <p>{{ (lang$ | async) === 'TC' ? translations.loading.TC : translations.loading.EN }}</p>
    </div>

    <!-- No Results State -->
    <div class="empty-state" *ngIf="!isLoading && restaurants.length === 0">
      <ion-icon name="search-outline" class="empty-icon"></ion-icon>
      <h2>{{ (lang$ | async) === 'TC' ? translations.noResults.TC : translations.noResults.EN }}</h2>
      <p>{{ (lang$ | async) === 'TC' ? translations.tryDifferent.TC : translations.tryDifferent.EN }}</p>
      <ion-button fill="outline" (click)="clearAllFilters()" *ngIf="selectedDistrict || selectedKeyword || searchQuery">
        {{ (lang$ | async) === 'TC' ? translations.clearFilters.TC : translations.clearFilters.EN }}
      </ion-button>
    </div>

    <!-- Restaurant Results Grid -->
    <div class="results-grid" *ngIf="!isLoading && restaurants.length > 0">
      <ion-card *ngFor="let restaurant of restaurants"
                class="restaurant-card"
                [routerLink]="['/restaurant', restaurant.id]"
                button>

        <!-- Restaurant Image -->
        <div class="card-image-container">
          <img [src]="restaurant.ImageUrl || 'assets/icon/Placeholder.png'"
               [alt]="(lang$ | async) === 'TC' ? restaurant.Name_TC : restaurant.Name_EN"
               class="restaurant-image">
          <div class="image-overlay"></div>
        </div>

        <!-- Restaurant Info -->
        <ion-card-content class="card-content">
          <h3 class="restaurant-name">
            {{ (lang$ | async) === 'TC' ? restaurant.Name_TC : restaurant.Name_EN }}
          </h3>

          <div class="restaurant-details">
            <div class="detail-row" *ngIf="restaurant.District_EN || restaurant.District_TC">
              <ion-icon name="location-outline" class="detail-icon"></ion-icon>
              <span class="detail-text">
                {{ (lang$ | async) === 'TC' ? restaurant.District_TC : restaurant.District_EN }}
              </span>
            </div>

            <div class="detail-row" *ngIf="restaurant.Keyword_EN?.length || restaurant.Keyword_TC?.length">
              <ion-icon name="pricetag-outline" class="detail-icon"></ion-icon>
              <div class="keywords-container">
                <ion-chip *ngFor="let keyword of getDisplayKeywords(restaurant); let i = index"
                          class="keyword-chip"
                          [class.hidden]="i >= 2">
                  {{ keyword }}
                </ion-chip>
                <ion-chip *ngIf="getKeywordCount(restaurant) > 2"
                          class="keyword-chip more-chip">
                  +{{ getKeywordCount(restaurant) - 2 }}
                </ion-chip>
              </div>
            </div>
          </div>

          <!-- View Details Link -->
          <div class="card-action">
            <ion-text color="primary" class="view-details">
              {{ (lang$ | async) === 'TC' ? translations.viewDetails.TC : translations.viewDetails.EN }}
              <ion-icon name="arrow-forward-outline"></ion-icon>
            </ion-text>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Pagination -->
    <div class="pagination-container" *ngIf="!isLoading && restaurants.length > 0 && totalPages > 1">
      <ion-button fill="outline"
                  [disabled]="currentPage === 0"
                  (click)="previousPage()"
                  class="pagination-button">
        <ion-icon name="chevron-back-outline" slot="icon-only"></ion-icon>
      </ion-button>

      <div class="page-info">
        <span class="current-page">{{ currentPage + 1 }}</span>
        <span class="page-separator">/</span>
        <span class="total-pages">{{ totalPages }}</span>
      </div>

      <ion-button fill="outline"
                  [disabled]="currentPage >= totalPages - 1"
                  (click)="nextPage()"
                  class="pagination-button">
        <ion-icon name="chevron-forward-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </div>

    <!-- Bottom Spacer -->
    <div class="bottom-spacer"></div>
  </div>
</ion-content>