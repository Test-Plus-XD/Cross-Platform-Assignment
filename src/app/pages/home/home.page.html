<!-- Page root: ion-content keeps Ionic behaviour and provides safe area / scrolling -->
<ion-content>
  <!-- Expose language and platform for template convenience -->
  <ng-container *ngIf="lang$ | async as curLang">
  <ng-container *ngIf="isMobile$ | async as isMobile">
  <!-- Main container with platform-aware class -->
    <div class="page-container" [class.mobile-layout]="isMobile" [class.web-layout]="!isMobile">
      <!-- Hero Banner with Auto-rotating Ads -->
      <div class="hero-section">
        <swiper-container #heroSwiper
                          class="hero-swiper"
                          loop="true"
                          [autoplay-delay]="isMobile ? 5000 : 7000"
                          autoplay-disable-on-interaction="false"
                          speed="800"
                          effect="fade">
          <swiper-slide *ngFor="let advertisement of (ads$ | async) || []">
            <div class="hero-slide">
              <img [src]="advertisement.image || 'assets/icon/Placeholder.png'"
                   [alt]="'Advertisement'"
                   class="hero-image">
              <div class="hero-overlay"></div>
              <div class="hero-content">
                <h1 class="hero-title">{{ (lang$ | async) === 'TC' ? '限時優惠' : 'Special Discount' }}</h1>
                <p class="hero-subtitle">{{ (lang$ | async) === 'TC' ? '探索精選餐廳優惠' : 'Discover exclusive restaurant deals' }}</p>
                <ion-button *ngIf="advertisement.href"
                            (click)="openUrl(advertisement.href)"
                            class="hero-button"
                            fill="solid"
                            size="large">
                  {{ (lang$ | async) === 'TC' ? '立即查看' : 'View Now' }}
                  <ion-icon name="arrow-forward-outline" slot="end"></ion-icon>
                </ion-button>
              </div>
            </div>
          </swiper-slide>
        </swiper-container>
      </div>

      <!-- Featured Offers Section -->
      <section class="content-section offers-section">
        <div class="section-header">
          <h2 class="section-title">{{ (lang$ | async) === 'TC' ? '甄選優惠' : 'Featured Offers' }}</h2>
          <ion-button fill="clear" routerLink="/offers" class="see-all-button">
            {{ (lang$ | async) === 'TC' ? '查看全部' : 'See All' }}
            <ion-icon name="chevron-forward-outline" slot="end"></ion-icon>
          </ion-button>
        </div>

        <swiper-container #offersSwiper
                          [class]="isMobile ? 'offers-swiper mobile-peek' : 'offers-swiper'"
                          [attr.slides-per-view]="isMobile ? '1.15' : '1.3'"
                          space-between="16"
                          centered-slides="true"
                          loop="true"
                          autoplay-delay="4000"
                          autoplay-disable-on-interaction="false"
                          speed="600"
                          breakpoints='{"640": {"slidesPerView": 2}, "1024": {"slidesPerView": 3}}'>
          <swiper-slide *ngFor="let offer of (offers$ | async) || []">
            <ion-card class="offer-card" (click)="setFeatured(offer.image)" button>
              <div class="card-image-container">
                <img [src]="offer.image || 'assets/icon/Placeholder.png'"
                     [alt]="offer.title"
                     class="card-image">
                <div class="card-overlay"></div>
              </div>
              <ion-card-content class="card-content">
                <h3 class="card-title">{{ offer.title }}</h3>
                <p class="card-subtitle">{{ offer.restaurant }}</p>
                <div class="card-action">
                  <ion-text color="primary" class="action-link">
                    {{ (lang$ | async) === 'TC' ? '查看詳情' : 'View Details' }}
                    <ion-icon name="arrow-forward-outline"></ion-icon>
                  </ion-text>
                </div>
              </ion-card-content>
            </ion-card>
          </swiper-slide>
        </swiper-container>
      </section>

      <!-- Articles Section -->
      <section class="content-section articles-section">
        <div class="section-header">
          <h2 class="section-title">{{ (lang$ | async) === 'TC' ? '飲食札記' : "Gourmet's Note" }}</h2>
          <ion-button fill="clear" routerLink="/articles" class="see-all-button">
            {{ (lang$ | async) === 'TC' ? '查看全部' : 'See All' }}
            <ion-icon name="chevron-forward-outline" slot="end"></ion-icon>
          </ion-button>
        </div>

        <swiper-container #articlesSwiper
                          [class]="isMobile ? 'articles-swiper mobile-peek' : 'articles-swiper'"
                          [attr.slides-per-view]="isMobile ? '1.15' : '1.3'"
                          space-between="16"
                          centered-slides="true"
                          loop="true"
                          autoplay-delay="5000"
                          autoplay-disable-on-interaction="false"
                          speed="600"
                          breakpoints='{"768": {"slidesPerView": 2}, "1024": {"slidesPerView": 3}}'>
          <swiper-slide *ngFor="let article of (articles$ | async) || []">
            <ion-card class="article-card" button>
              <div class="card-image-container">
                <img [src]="article.image || 'assets/icon/Placeholder.png'"
                     [alt]="(lang$ | async) === 'TC' ? article.title_TC : article.title_EN"
                     class="card-image">
                <div class="card-overlay"></div>
              </div>
              <ion-card-content class="card-content">
                <h3 class="card-title">{{ (lang$ | async) === 'TC' ? article.title_TC : article.title_EN }}</h3>
                <p class="card-text">{{ (lang$ | async) === 'TC' ? article.excerpt_TC : article.excerpt_EN }}</p>
                <div class="card-action">
                  <ion-text color="primary" class="action-link">
                    {{ (lang$ | async) === 'TC' ? '閱讀更多' : 'Read More' }}
                    <ion-icon name="arrow-forward-outline"></ion-icon>
                  </ion-text>
                </div>
              </ion-card-content>
            </ion-card>
          </swiper-slide>
        </swiper-container>
      </section>

      <!-- Reviews Section -->
      <section class="content-section reviews-section">
        <div class="section-header">
          <h2 class="section-title">{{ (lang$ | async) === 'TC' ? '最近評論' : 'Latest Reviews' }}</h2>
          <ion-button fill="clear" routerLink="/reviews" class="see-all-button">
            {{ (lang$ | async) === 'TC' ? '查看全部' : 'See All' }}
            <ion-icon name="chevron-forward-outline" slot="end"></ion-icon>
          </ion-button>
        </div>

        <swiper-container #reviewsSwiper
                          [class]="isMobile ? 'reviews-swiper mobile-peek' : 'reviews-swiper'"
                          [attr.slides-per-view]="isMobile ? '1.15' : '1.3'"
                          space-between="16"
                          centered-slides="true"
                          loop="true"
                          autoplay-delay="6000"
                          autoplay-disable-on-interaction="false"
                          speed="600"
                          breakpoints='{"768": {"slidesPerView": 2}, "1024": {"slidesPerView": 3}}'>
          <swiper-slide *ngFor="let review of (reviews$ | async) || []">
            <ion-card class="review-card">
              <ion-card-content class="card-content">
                <div class="review-header">
                  <ion-avatar class="review-avatar">
                    <img [src]="review.avatar || 'assets/icon/Placeholder.png'" [alt]="review.name">
                  </ion-avatar>
                  <div class="review-meta">
                    <h4 class="review-name">{{ review.name }}</h4>
                    <p class="review-info">{{ review.meta }}</p>
                  </div>
                </div>
                <!-- Review Image (if available) -->
                <div class="review-image-container" *ngIf="review.imageUrl">
                  <img [src]="review.imageUrl"
                       [alt]="'Review image'"
                       class="review-image">
                </div>
                <p class="review-text">{{ review.text }}</p>
                <div class="review-rating">
                  <ion-icon name="star" *ngFor="let star of [1,2,3,4,5]"
                            [class.filled]="star <= review.rating"></ion-icon>
                  <span class="rating-value">{{ review.rating }}</span>
                </div>
              </ion-card-content>
            </ion-card>
          </swiper-slide>
        </swiper-container>
      </section>

      <!-- Trending Restaurants Section -->
      <section class="content-section restaurants-section">
        <div class="section-header">
          <h2 class="section-title">{{ (lang$ | async) === 'TC' ? '熱門餐廳' : 'Trending Restaurants' }}</h2>
          <ion-button fill="clear" routerLink="/restaurants" class="see-all-button">
            {{ (lang$ | async) === 'TC' ? '查看全部' : 'See All' }}
            <ion-icon name="chevron-forward-outline" slot="end"></ion-icon>
          </ion-button>
        </div>

        <swiper-container #restaurantsSwiper
                          [class]="isMobile ? 'restaurants-swiper mobile-peek' : 'restaurants-swiper'"
                          [attr.slides-per-view]="isMobile ? '1.15' : '1.3'"
                          space-between="16"
                          centered-slides="true"
                          loop="true"
                          autoplay-delay="7000"
                          autoplay-disable-on-interaction="false"
                          speed="600"
                          breakpoints='{"640": {"slidesPerView": 2}, "1024": {"slidesPerView": 3}}'>
          <swiper-slide *ngFor="let restaurant of (restaurants$ | async) || []">
            <ion-card class="restaurant-card" button>
              <div class="card-image-container">
                <img [src]="restaurant.image || 'assets/icon/Placeholder.png'"
                     [alt]="(lang$ | async) === 'TC' ? restaurant.Name_TC : restaurant.Name_EN"
                     class="card-image">
                <div class="card-overlay"></div>
              </div>
              <ion-card-content class="card-content">
                <h3 class="card-title">{{ (lang$ | async) === 'TC' ? restaurant.Name_TC : restaurant.Name_EN }}</h3>
                <p class="card-subtitle">{{ (lang$ | async) === 'TC' ? restaurant.Address_TC : restaurant.Address_EN }}</p>
              </ion-card-content>
            </ion-card>
          </swiper-slide>
        </swiper-container>
      </section>

      <!-- Mobile App Promotion -->
      <section class="content-section app-promo-section">
        <ion-card class="app-promo-card">
          <ion-card-content>
            <div class="app-promo-content">
              <div class="app-promo-text">
                <h2 class="app-promo-title">{{ (lang$ | async) === 'TC' ? '手機程式' : 'Mobile App' }}</h2>
                <p class="app-promo-description">
                  {{ (lang$ | async) === 'TC' ? '下載應用程式以取得優惠與位置功能。' : 'Download for deals & location features.' }}
                </p>
              </div>
              <div class="app-promo-badges">
                <img src="assets/icon/App_Store.png" alt="App Store" class="store-badge">
                <img src="assets/icon/Google_Play.png" alt="Google Play" class="store-badge">
              </div>
            </div>
          </ion-card-content>
        </ion-card>
      </section>

      <!-- Bottom Spacer -->
      <div class="bottom-spacer"></div>
    </div>
  </ng-container>
  </ng-container>
</ion-content>